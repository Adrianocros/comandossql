#Criando Banco com DBeaver :bear:

##Utilizando o  PostGres :elephant:



/*CRIANDO TABELAS*/

create table pedidos(
id int primary key,
produtos varchar(50),
desconto_aplicado decimal,
valor_cobrado decimal,
cliente varchar(50)
);

create table clientes(
id int primary key,
nome varchar(220),
telefone varchar(11)
);

/*ALTERANDO TABELA*/

alter table pedidos 
add column id_cliente int;

alter table pedidos
drop column cliente;

/*CRIANDO RELACIONAMENTOS*/

alter table pedidos 
add constraint fk_cliente
foreign key (id_cliente)
references clientes(id);

/*CRIANDO TABELA DE PEDIDO DE PRODUTOS E CRIANDO RELACIONAMENTOS*/

create table produtos(
id int primary key,
descricao varchar(50),
valor decimal
);

/*TABELA JA COM TODAS CONSTRAINTS*/

create table items_pedido(
id_pedido int,
id_produto int,
quantidade int,
primary key (id_pedido, id_produto),
constraint fk_pedidos
	foreign key(id_pedido)
	references pedidos(id),
constraint fk_produtos
	foreign key(id_produto)
	references produtos(id)
);

alter table pedidos
drop column valor_cobrado;



# Inserindo dados e alterando com DBever :bear:

/* INSERINDO DADOS*/

insert  into clientes 
(nome,telefone)
values
('Adriano','8584838322'),
('Lucas','88393939455'),
('Maria','93394583889'),
('Silvana','98394358482'),
('Marcos','39589583838');

delete  from clientes;

/*alterando a coluna ID para gerar codigo automatico*/

alter table clientes 
alter column id
add generated by default as identity;

select * from clientes;

update clientes 
set telefone = '99494949393'
where id = '1';

delete from clientes
where id = '1';

## Consultas mais elaboradas  :page_with_curl:

/*inner join*/

select p.id as id_pedido, c.nome, c.telefone
from pedidos p
inner join clientes c 
on p.id_cliente = c.id
inner join items_pedido ip
on p.id  = id_pedido 
inner  join produtos p2
on ip.id_produto = p2.id
where p2.descricao like 'coca-cola';

select p.id as id_pedido, c.nome,sum(p2.valor * ip.quantidade) as valor_total
from pedidos p
inner join clientes c 
on p.id_cliente = c.id
inner join items_pedido ip
on p.id  = id_pedido 
inner  join produtos p2
on ip.id_produto = p2.id
group by p.id, c.nome 
order  by valor_total desc;


select max(id) from clientes c;

/*SUBQUERY*/
select * from pedidos p2 where p2.id_cliente in(
select id from clientes c where id < 3
);

